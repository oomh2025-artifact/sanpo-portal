<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç”£æ¥­ä¿å¥æƒ…å ±ãƒãƒ¼ã‚¿ãƒ«</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Noto Sans JP', sans-serif; background: #f8fafc; color: #1e293b; line-height: 1.5; font-size: 14px; }

    .header { background: #fff; border-bottom: 1px solid #e2e8f0; padding: 0.6rem 1.5rem; position: sticky; top: 0; z-index: 100; }
    .header-inner { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
    .logo { font-size: 1rem; font-weight: 700; color: #1e293b; cursor: pointer; }
    .logo span { color: #3b82f6; }
    .nav { display: flex; gap: 0.25rem; }
    .nav-btn { padding: 0.35rem 0.7rem; border: none; background: transparent; color: #64748b; font-size: 0.75rem; font-weight: 500; cursor: pointer; border-radius: 4px; transition: all 0.15s; font-family: inherit; }
    .nav-btn:hover { background: #f1f5f9; color: #1e293b; }
    .nav-btn.active { background: #1e293b; color: #fff; }

    .main { max-width: 1200px; margin: 0 auto; padding: 1rem 1.5rem; }
    .page { display: none; animation: fadeIn 0.15s ease; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .main-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin-bottom: 1rem; }
    @media (max-width: 768px) { .main-cards { grid-template-columns: 1fr; } }
    .main-card { padding: 1.25rem; border-radius: 8px; color: #fff; cursor: pointer; transition: transform 0.15s, box-shadow 0.15s; border: none; text-align: left; font-family: inherit; }
    .main-card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
    .main-card.blue { background: #2563eb; }
    .main-card.amber { background: #f59e0b; }
    .main-card.green { background: #10b981; }
    .main-card h2 { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.15rem; }
    .main-card p { font-size: 0.7rem; opacity: 0.9; }

    .news-box { background: #fff; border-radius: 8px; border: 1px solid #e2e8f0; overflow: hidden; }
    .news-header { background: #1e293b; color: #fff; padding: 0.5rem 0.75rem; font-weight: 700; font-size: 0.8rem; }
    .news-list { padding: 0.25rem; }
    .news-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.6rem; border-radius: 4px; cursor: pointer; transition: background 0.15s; text-decoration: none; color: inherit; }
    .news-item:hover { background: #f1f5f9; }
    .news-tag { font-size: 0.6rem; font-weight: 700; padding: 0.1rem 0.4rem; border-radius: 8px; white-space: nowrap; }
    .news-tag.blue { background: #dbeafe; color: #1d4ed8; }
    .news-tag.amber { background: #fef3c7; color: #b45309; }
    .news-text { flex: 1; font-size: 0.75rem; }
    .news-arrow { color: #94a3b8; font-size: 0.7rem; }

    .page-title { margin-bottom: 0.75rem; }
    .page-title h2 { font-size: 1.1rem; font-weight: 700; }
    .page-title p { color: #64748b; font-size: 0.7rem; }

    .filter-bar { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-bottom: 0.75rem; }
    .filter-btn { padding: 0.25rem 0.6rem; border: 1px solid #e2e8f0; background: #fff; border-radius: 12px; font-size: 0.65rem; cursor: pointer; transition: all 0.15s; font-family: inherit; }
    .filter-btn:hover { border-color: #cbd5e1; }
    .filter-btn.active { background: #1e293b; color: #fff; border-color: #1e293b; }

    .timeline { position: relative; padding-left: 1.25rem; }
    .timeline::before { content: ''; position: absolute; left: 4px; top: 0; bottom: 0; width: 2px; background: linear-gradient(to bottom, #3b82f6, #e2e8f0); }
    .timeline-item { position: relative; margin-bottom: 0.75rem; }
    .timeline-dot { position: absolute; left: -16px; top: 5px; width: 10px; height: 10px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 0 0 1px #e2e8f0; }
    .timeline-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.75rem; }
    .timeline-meta { display: flex; align-items: center; gap: 0.4rem; margin-bottom: 0.3rem; flex-wrap: wrap; }
    .timeline-date { font-size: 0.65rem; color: #64748b; font-family: monospace; }
    .timeline-category { font-size: 0.55rem; font-weight: 700; padding: 0.1rem 0.4rem; border-radius: 3px; color: #fff; }
    .timeline-title { font-size: 0.8rem; font-weight: 700; margin-bottom: 0.2rem; }
    .timeline-summary { font-size: 0.7rem; color: #475569; }
    .timeline-footer { margin-top: 0.4rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.3rem; }
    .timeline-source { font-size: 0.6rem; color: #94a3b8; }
    .timeline-link { display: inline-flex; align-items: center; gap: 0.2rem; font-size: 0.6rem; color: #3b82f6; text-decoration: none; padding: 0.2rem 0.5rem; background: #eff6ff; border-radius: 3px; transition: background 0.15s; }
    .timeline-link:hover { background: #dbeafe; }

    .update-info { font-size: 0.65rem; color: #64748b; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; }
    .update-info .dot { width: 6px; height: 6px; background: #10b981; border-radius: 50%; }
    .articles-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.6rem; }
    @media (max-width: 1000px) { .articles-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 700px) { .articles-grid { grid-template-columns: 1fr; } }
    .journal-section { background: #fff; border: 1px solid #e2e8f0; border-radius: 6px; overflow: hidden; display: flex; flex-direction: column; }
    .journal-header { padding: 0.5rem 0.6rem; color: #fff; }
    .journal-header h3 { font-size: 0.7rem; font-weight: 700; }
    .journal-header .issue { font-size: 0.55rem; opacity: 0.9; margin-top: 0.1rem; }
    .journal-articles { padding: 0.4rem; flex: 1; }
    .article-item { padding: 0.4rem; background: #f8fafc; border-radius: 3px; margin-bottom: 0.3rem; }
    .article-item:last-child { margin-bottom: 0; }
    .article-title { font-weight: 600; font-size: 0.65rem; line-height: 1.35; margin-bottom: 0.15rem; }
    .article-authors { font-size: 0.55rem; color: #64748b; }
    .journal-footer { padding: 0.4rem 0.5rem; border-top: 1px solid #e2e8f0; background: #f8fafc; }
    .journal-footer a { font-size: 0.6rem; color: #3b82f6; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.25rem; font-weight: 500; }
    .journal-footer a:hover { text-decoration: underline; }

    .journal-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
    @media (max-width: 800px) { .journal-grid { grid-template-columns: 1fr; } }
    .journal-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; cursor: pointer; transition: all 0.15s; }
    .journal-card:hover { border-color: #3b82f6; box-shadow: 0 3px 10px rgba(59, 130, 246, 0.1); }
    .journal-card-header { display: flex; align-items: flex-start; gap: 0.6rem; margin-bottom: 0.5rem; }
    .journal-card-icon { width: 32px; height: 32px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; }
    .journal-card-info h3 { font-size: 0.8rem; font-weight: 700; margin-bottom: 0.1rem; }
    .journal-card-info p { font-size: 0.65rem; color: #64748b; }
    .journal-card-desc { font-size: 0.7rem; color: #475569; line-height: 1.45; background: #f8fafc; padding: 0.6rem; border-radius: 4px; }

    .back-btn { display: inline-flex; align-items: center; gap: 0.25rem; background: none; border: none; color: #64748b; font-size: 0.7rem; cursor: pointer; margin-bottom: 0.5rem; font-family: inherit; }
    .back-btn:hover { color: #1e293b; }
    .journal-detail-header { padding: 1.25rem; border-radius: 8px; color: #fff; margin-bottom: 0.75rem; }
    .journal-detail-header h2 { font-size: 1.1rem; margin-bottom: 0.1rem; }
    .journal-detail-header .pub { opacity: 0.8; font-size: 0.7rem; margin-bottom: 0.4rem; }
    .journal-detail-header .desc { font-size: 0.7rem; opacity: 0.9; margin-bottom: 0.6rem; line-height: 1.45; }
    .journal-detail-header a { display: inline-block; background: rgba(255,255,255,0.2); color: #fff; padding: 0.3rem 0.6rem; border-radius: 4px; font-size: 0.65rem; text-decoration: none; }
    .detail-article { background: #fff; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.75rem; margin-bottom: 0.5rem; }
    .detail-article h4 { font-size: 0.8rem; font-weight: 700; margin-bottom: 0.2rem; }
    .detail-article .authors { font-size: 0.65rem; color: #64748b; }

    .footer { background: #1e293b; color: #94a3b8; padding: 1rem; margin-top: 1.5rem; text-align: center; font-size: 0.6rem; }

    .sources-section { margin-top: 1.5rem; padding: 1rem; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; }
    .sources-section h3 { font-size: 0.85rem; font-weight: 700; margin-bottom: 0.75rem; color: #1e293b; }
    .sources-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.5rem; }
    .source-link { display: flex; align-items: center; gap: 0.4rem; padding: 0.5rem 0.75rem; background: #f8fafc; border-radius: 4px; text-decoration: none; color: #334155; font-size: 0.7rem; transition: all 0.15s; }
    .source-link:hover { background: #e0f2fe; color: #1d4ed8; }
    .source-link .icon { font-size: 0.8rem; }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-inner">
      <div class="logo" onclick="showPage('home')">ç”£æ¥­ä¿å¥<span>ãƒãƒ¼ã‚¿ãƒ«</span></div>
      <nav class="nav">
        <button class="nav-btn" data-page="regulations" onclick="showPage('regulations')">åˆ¶åº¦æ”¹æ­£</button>
        <button class="nav-btn" data-page="articles" onclick="showPage('articles')">æœ€æ–°è¨˜äº‹</button>
        <button class="nav-btn" data-page="journals" onclick="showPage('journals')">é›‘èªŒä¸€è¦§</button>
      </nav>
    </div>
  </header>

  <main class="main">
    <div id="page-home" class="page active">
      <div class="main-cards">
        <button class="main-card blue" onclick="showPage('regulations')">
          <h2>åˆ¶åº¦æ”¹æ­£</h2>
          <p>æ³•ä»¤ãƒ»ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã®æœ€æ–°æ”¹æ­£æƒ…å ±</p>
        </button>
        <button class="main-card amber" onclick="showPage('articles')">
          <h2>æœ€æ–°è¨˜äº‹</h2>
          <p>å„å­¦è¡“èªŒã®æœ€æ–°è«–æ–‡ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰</p>
        </button>
        <button class="main-card green" onclick="showPage('journals')">
          <h2>é›‘èªŒä¸€è¦§</h2>
          <p>J-STAGEç„¡æ–™é–²è¦§å¯èƒ½ãªå­¦è¡“èªŒ</p>
        </button>
      </div>
      <div class="news-box">
        <div class="news-header">Quick Links</div>
        <div class="news-list">
          <a class="news-item" href="https://www.mhlw.go.jp/bunya/roudoukijun/anzeneisei12/" target="_blank" rel="noopener">
            <span class="news-tag blue">åšåŠ´çœ</span>
            <span class="news-text">ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯åˆ¶åº¦ã«ã¤ã„ã¦</span>
            <span class="news-arrow">â†’</span>
          </a>
          <a class="news-item" href="https://www.jstage.jst.go.jp/browse/sangyoeisei/-char/ja" target="_blank" rel="noopener">
            <span class="news-tag amber">J-STAGE</span>
            <span class="news-text">ç”£æ¥­è¡›ç”Ÿå­¦é›‘èªŒ æœ€æ–°å·</span>
            <span class="news-arrow">â†’</span>
          </a>
          <a class="news-item" href="https://www.jstage.jst.go.jp/browse/jjomh/-char/ja" target="_blank" rel="noopener">
            <span class="news-tag amber">J-STAGE</span>
            <span class="news-text">ç”£æ¥­ç²¾ç¥ä¿å¥ æœ€æ–°å·</span>
            <span class="news-arrow">â†’</span>
          </a>
        </div>
      </div>
    </div>

    <div id="page-regulations" class="page">
      <div class="page-title">
        <h2>åˆ¶åº¦æ”¹æ­£</h2>
        <p>ç”£æ¥­ä¿å¥ã«é–¢ã™ã‚‹æ³•ä»¤ãƒ»ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã®æ”¹æ­£æƒ…å ±</p>
      </div>
      <div class="filter-bar">
        <button class="filter-btn active" onclick="filterRegulations('all', this)">ã™ã¹ã¦</button>
        <button class="filter-btn" onclick="filterRegulations('ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯', this)">ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯</button>
        <button class="filter-btn" onclick="filterRegulations('åŒ–å­¦ç‰©è³ªç®¡ç†', this)">åŒ–å­¦ç‰©è³ªç®¡ç†</button>
        <button class="filter-btn" onclick="filterRegulations('åŠ´åƒæ™‚é–“', this)">åŠ´åƒæ™‚é–“</button>
        <button class="filter-btn" onclick="filterRegulations('ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆ', this)">ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆ</button>
      </div>
      <div class="timeline" id="timeline"></div>
      <div class="sources-section">
        <h3>ğŸ“š å…¬å¼æƒ…å ±æº</h3>
        <div class="sources-grid">
          <a class="source-link" href="https://www.mhlw.go.jp/bunya/roudoukijun/anzeneisei12/" target="_blank" rel="noopener"><span class="icon">ğŸ›ï¸</span> ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯åˆ¶åº¦ï¼ˆåšåŠ´çœï¼‰</a>
          <a class="source-link" href="https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/koyou_roudou/roudoukijun/anzen/anzeneisei02.html" target="_blank" rel="noopener"><span class="icon">ğŸ›ï¸</span> åŒ–å­¦ç‰©è³ªå¯¾ç­–ï¼ˆåšåŠ´çœï¼‰</a>
          <a class="source-link" href="https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/0000148322.html" target="_blank" rel="noopener"><span class="icon">ğŸ›ï¸</span> åƒãæ–¹æ”¹é©ï¼ˆåšåŠ´çœï¼‰</a>
          <a class="source-link" href="https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/koyou_roudou/koyoukintou/seisaku06/index.html" target="_blank" rel="noopener"><span class="icon">ğŸ›ï¸</span> ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆå¯¾ç­–ï¼ˆåšåŠ´çœï¼‰</a>
          <a class="source-link" href="https://www.jaish.gr.jp/" target="_blank" rel="noopener"><span class="icon">ğŸ“–</span> å®‰å…¨è¡›ç”Ÿæƒ…å ±ã‚»ãƒ³ã‚¿ãƒ¼</a>
          <a class="source-link" href="https://kokoro.mhlw.go.jp/" target="_blank" rel="noopener"><span class="icon">ğŸ’™</span> ã“ã“ã‚ã®è€³ï¼ˆåšåŠ´çœï¼‰</a>
          <a class="source-link" href="https://www.johas.go.jp/" target="_blank" rel="noopener"><span class="icon">ğŸ¥</span> åŠ´åƒè€…å¥åº·å®‰å…¨æ©Ÿæ§‹</a>
          <a class="source-link" href="https://elaws.e-gov.go.jp/" target="_blank" rel="noopener"><span class="icon">âš–ï¸</span> e-Govæ³•ä»¤æ¤œç´¢</a>
        </div>
      </div>
    </div>

    <div id="page-articles" class="page">
      <div class="page-title">
        <h2>æœ€æ–°è¨˜äº‹</h2>
        <p>å„å­¦è¡“èªŒã®æœ€æ–°è«–æ–‡ï¼ˆJ-STAGEã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰</p>
      </div>
      <div class="update-info" id="update-info"><span class="dot" style="background:#94a3b8"></span><span>èª­ã¿è¾¼ã¿ä¸­...</span></div>
      <div class="articles-grid" id="articles-list">
        <div style="grid-column: 1/-1; text-align:center; padding:2rem; color:#64748b;">J-STAGEã‹ã‚‰è«–æ–‡æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™...</div>
      </div>
    </div>

    <div id="page-journals" class="page">
      <div class="page-title">
        <h2>é›‘èªŒä¸€è¦§</h2>
        <p>J-STAGEã§ç„¡æ–™é–²è¦§å¯èƒ½ãªç”£æ¥­ä¿å¥é–¢é€£å­¦è¡“èªŒ</p>
      </div>
      <div class="journal-grid" id="journal-grid">
        <div style="grid-column: 1/-1; text-align:center; padding:2rem; color:#64748b;">é›‘èªŒæƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™...</div>
      </div>
    </div>

    <div id="page-journal-detail" class="page">
      <button class="back-btn" onclick="showPage('journals')">â† é›‘èªŒä¸€è¦§ã«æˆ»ã‚‹</button>
      <div id="journal-detail-content"></div>
    </div>
  </main>

  <footer class="footer">
    <p>ç”£æ¥­ä¿å¥ã«é–¢ã™ã‚‹æ³•ä»¤ãƒ»ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»å­¦è¡“æƒ…å ±ã®åé›†ã‚’ç›®çš„ã¨ã—ãŸãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆã§ã™</p>
    <p style="margin-top: 0.2rem; opacity: 0.7;">â€» è«–æ–‡æƒ…å ±ã¯J-STAGE Web APIã‹ã‚‰ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å–å¾—ã—ã¦ã„ã¾ã™</p>
  </footer>

  <script>
    // ========================================
    // è«–æ–‡ãƒ‡ãƒ¼ã‚¿ï¼ˆNetlify Functionã‹ã‚‰ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–å¾—ï¼‰
    // ========================================
    let articlesData = null;
    
    // é›‘èªŒã®èª¬æ˜æ–‡ï¼ˆAPIã«ã¯å«ã¾ã‚Œãªã„ãŸã‚é™çš„ã«ä¿æŒï¼‰
    const JOURNAL_DESCRIPTIONS = {
      "sangyoeisei": "æ—¥æœ¬ç”£æ¥­è¡›ç”Ÿå­¦ä¼šã®æ©Ÿé–¢èªŒã€‚åŸè‘—è«–æ–‡ã€ç·èª¬ã€äº‹ä¾‹å ±å‘Šãªã©ã‚’æ²è¼‰ã€‚",
      "indhealth": "å›½éš›çš„æŸ»èª­ä»˜ãè‹±æ–‡èªŒã€‚ç”£æ¥­åŒ»å­¦ã€äººé–“å·¥å­¦ã€ç”£æ¥­è¡›ç”Ÿãªã©å¹…åºƒã„åˆ†é‡ã‚’ã‚«ãƒãƒ¼ã€‚",
      "ohpfrev": "ç”£æ¥­åŒ»å­¦é ˜åŸŸã®é‡è¦ãƒ†ãƒ¼ãƒã«ã¤ã„ã¦å°‚é–€å®¶ã«ã‚ˆã‚‹ç·èª¬è«–æ–‡ã‚’æ²è¼‰ã€‚",
      "jjomh": "è·å ´ã®ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ã«ç‰¹åŒ–ã—ãŸå°‚é–€èªŒã€‚",
      "jaohn": "ç”£æ¥­çœ‹è­·ã®å®Ÿè·µã€æ•™è‚²ã€ä¸¡ç«‹æ”¯æ´ã«ãŠã‘ã‚‹çœ‹è­·è·ã®å½¹å‰²ãªã©ã‚’æ²è¼‰ã€‚",
      "jaohl": "ç”£æ¥­ä¿å¥æ³•å­¦ã«é–¢ã™ã‚‹å°‚é–€èªŒã€‚æ³•ã®çŸ¥è¦‹ã‚’åŸºç¤ã«ç¾å ´èª²é¡Œã®è§£æ±ºã‚’æ¢æ±‚ã€‚"
    };

    // é›‘èªŒãƒªã‚¹ãƒˆ
    const JOURNALS_CONFIG = [
      { id: 'sangyoeisei', name: 'ç”£æ¥­è¡›ç”Ÿå­¦é›‘èªŒ', publisher: 'æ—¥æœ¬ç”£æ¥­è¡›ç”Ÿå­¦ä¼š', color: '#0066cc', cdjournal: 'sangyoeisei' },
      { id: 'indhealth', name: 'Industrial Health', publisher: 'åŠ´åƒå®‰å…¨è¡›ç”Ÿç·åˆç ”ç©¶æ‰€', color: '#006644', cdjournal: 'indhealth' },
      { id: 'ohpfrev', name: 'ç”£æ¥­åŒ»å­¦ãƒ¬ãƒ“ãƒ¥ãƒ¼', publisher: 'ç”£æ¥­åŒ»å­¦æŒ¯èˆˆè²¡å›£', color: '#cc3300', cdjournal: 'ohpfrev' },
      { id: 'jjomh', name: 'ç”£æ¥­ç²¾ç¥ä¿å¥', publisher: 'æ—¥æœ¬ç”£æ¥­ç²¾ç¥ä¿å¥å­¦ä¼š', color: '#9933cc', cdjournal: 'jjomh' },
      { id: 'jaohn', name: 'æ—¥æœ¬ç”£æ¥­çœ‹è­·å­¦ä¼šèªŒ', publisher: 'æ—¥æœ¬ç”£æ¥­çœ‹è­·å­¦ä¼š', color: '#e91e63', cdjournal: 'jaohn' },
      { id: 'jaohl', name: 'ç”£æ¥­ä¿å¥æ³•å­¦ä¼šèªŒ', publisher: 'æ—¥æœ¬ç”£æ¥­ä¿å¥æ³•å­¦ä¼š', color: '#336699', cdjournal: 'jaohl' },
    ];

    async function fetchJournalDirect(j) {
      try {
        const apiUrl = 'https://api.jstage.jst.go.jp/searchapi/do?service=3&cdjournal=' + j.cdjournal + '&count=5';
        const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(apiUrl);
        
        const res = await fetch(proxyUrl, { signal: AbortSignal.timeout(10000) });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const xml = await res.text();
        
        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°: ã‚¿ã‚°ã®ä¸­èº«ã‚’å–å¾—
        function getTag(str, tag) {
          const re = new RegExp('<' + tag + '[^>]*>([\\s\\S]*?)</' + tag + '>', 'i');
          const m = str.match(re);
          return m ? m[1] : '';
        }
        
        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°: CDATAé™¤å»ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        function clean(str) {
          return (str || '').replace(/<!\[CDATA\[/g, '').replace(/\]\]>/g, '').replace(/<[^>]+>/g, '').replace(/\s+/g, ' ').trim();
        }
        
        const articles = [];
        const entries = xml.split('<entry>');
        
        for (let i = 1; i < entries.length && articles.length < 3; i++) {
          const entry = entries[i];
          let title = '';
          
          // ã‚¿ã‚¤ãƒˆãƒ«å–å¾—: <article_title><ja><![CDATA[ã‚¿ã‚¤ãƒˆãƒ«]]></ja></article_title>
          const articleTitle = getTag(entry, 'article_title');
          if (articleTitle) {
            const jaTitle = getTag(articleTitle, 'ja');
            title = clean(jaTitle || getTag(articleTitle, 'en') || articleTitle);
          }
          if (!title) {
            title = clean(getTag(entry, 'title'));
          }
          
          // è‘—è€…å–å¾—: <author><ja><n><![CDATA[è‘—è€…å]]></n></ja></author>
          let authors = '';
          const authorBlock = getTag(entry, 'author');
          if (authorBlock) {
            const jaAuthor = getTag(authorBlock, 'ja');
            const src = jaAuthor || getTag(authorBlock, 'en') || authorBlock;
            const names = [];
            const nRe = /<n>([\s\S]*?)<\/n>/g;
            let m;
            while ((m = nRe.exec(src)) !== null) {
              const name = clean(m[1]);
              if (name) names.push(name);
            }
            if (names.length > 2) authors = names[0] + ' ä»–';
            else if (names.length > 0) authors = names.join(', ');
          }
          
          if (title && title.length > 3) {
            articles.push({ title: title.slice(0, 100), authors: authors });
          }
        }
        
        // å·»å·å–å¾—
        let issue = '';
        if (entries[1]) {
          const e = entries[1];
          const vol = clean(getTag(e, 'prism:volume'));
          const no = clean(getTag(e, 'prism:number'));
          const year = clean(getTag(e, 'pubyear'));
          if (vol) {
            if (year) issue += year + 'å¹´ ';
            issue += vol + 'å·»';
            if (no) issue += no + 'å·';
          }
        }
        
        return {
          id: j.id, name: j.name, publisher: j.publisher, color: j.color,
          url: 'https://www.jstage.jst.go.jp/browse/' + j.cdjournal + '/-char/ja',
          description: JOURNAL_DESCRIPTIONS[j.id] || '',
          latest_issue: issue, articles: articles
        };
      } catch (e) {
        console.error(j.name + ': ' + e.message);
        return {
          id: j.id, name: j.name, publisher: j.publisher, color: j.color,
          url: 'https://www.jstage.jst.go.jp/browse/' + j.cdjournal + '/-char/ja',
          description: JOURNAL_DESCRIPTIONS[j.id] || '',
          latest_issue: '', articles: []
        };
      }
    }

    async function loadArticlesData() {
      try {
        document.getElementById('update-info').innerHTML = '<span class="dot" style="background:#f59e0b"></span><span>J-STAGEã‹ã‚‰å–å¾—ä¸­...</span>';
        
        const results = await Promise.all(JOURNALS_CONFIG.map(fetchJournalDirect));
        
        articlesData = {
          updated_at: new Date().toISOString().split('T')[0],
          journals: results
        };
        
        document.getElementById('update-info').innerHTML = '<span class="dot"></span><span>æœ€çµ‚å–å¾—: ' + articlesData.updated_at + 'ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰</span>';
        renderArticles();
        renderJournalGrid();
      } catch (error) {
        console.error('Error loading articles:', error);
        document.getElementById('update-info').innerHTML = '<span class="dot" style="background:#ef4444"></span><span>å–å¾—å¤±æ•— - J-STAGEã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„</span>';
        articlesData = getFallbackData();
        renderArticles();
        renderJournalGrid();
      }
    }
    
    function getFallbackData() {
      return {
        updated_at: "ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼‰",
        journals: [
          { id: "sangyoeisei", name: "ç”£æ¥­è¡›ç”Ÿå­¦é›‘èªŒ", publisher: "æ—¥æœ¬ç”£æ¥­è¡›ç”Ÿå­¦ä¼š", color: "#0066cc", url: "https://www.jstage.jst.go.jp/browse/sangyoeisei/-char/ja", description: JOURNAL_DESCRIPTIONS["sangyoeisei"], latest_issue: "", articles: [] },
          { id: "indhealth", name: "Industrial Health", publisher: "åŠ´åƒå®‰å…¨è¡›ç”Ÿç·åˆç ”ç©¶æ‰€", color: "#006644", url: "https://www.jstage.jst.go.jp/browse/indhealth/-char/ja", description: JOURNAL_DESCRIPTIONS["indhealth"], latest_issue: "", articles: [] },
          { id: "ohpfrev", name: "ç”£æ¥­åŒ»å­¦ãƒ¬ãƒ“ãƒ¥ãƒ¼", publisher: "ç”£æ¥­åŒ»å­¦æŒ¯èˆˆè²¡å›£", color: "#cc3300", url: "https://www.jstage.jst.go.jp/browse/ohpfrev/-char/ja", description: JOURNAL_DESCRIPTIONS["ohpfrev"], latest_issue: "", articles: [] },
          { id: "jjomh", name: "ç”£æ¥­ç²¾ç¥ä¿å¥", publisher: "æ—¥æœ¬ç”£æ¥­ç²¾ç¥ä¿å¥å­¦ä¼š", color: "#9933cc", url: "https://www.jstage.jst.go.jp/browse/jjomh/-char/ja", description: JOURNAL_DESCRIPTIONS["jjomh"], latest_issue: "", articles: [] },
          { id: "jaohn", name: "æ—¥æœ¬ç”£æ¥­çœ‹è­·å­¦ä¼šèªŒ", publisher: "æ—¥æœ¬ç”£æ¥­çœ‹è­·å­¦ä¼š", color: "#e91e63", url: "https://www.jstage.jst.go.jp/browse/jaohn/-char/ja", description: JOURNAL_DESCRIPTIONS["jaohn"], latest_issue: "", articles: [] },
          { id: "jaohl", name: "ç”£æ¥­ä¿å¥æ³•å­¦ä¼šèªŒ", publisher: "æ—¥æœ¬ç”£æ¥­ä¿å¥æ³•å­¦ä¼š", color: "#336699", url: "https://www.jstage.jst.go.jp/browse/jaohl/-char/ja", description: JOURNAL_DESCRIPTIONS["jaohl"], latest_issue: "", articles: [] },
        ]
      };
    }

    // ========================================
    // å…¬å¼æƒ…å ±æºURL
    // ========================================
    const OFFICIAL_SOURCES = {
      'ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯': { name: 'åšåŠ´çœ ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯åˆ¶åº¦', url: 'https://www.mhlw.go.jp/bunya/roudoukijun/anzeneisei12/' },
      'åŒ–å­¦ç‰©è³ªç®¡ç†': { name: 'åšåŠ´çœ åŒ–å­¦ç‰©è³ªå¯¾ç­–', url: 'https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/koyou_roudou/roudoukijun/anzen/anzeneisei02.html' },
      'åŠ´åƒæ™‚é–“': { name: 'åšåŠ´çœ åƒãæ–¹æ”¹é©', url: 'https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/0000148322.html' },
      'ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆ': { name: 'åšåŠ´çœ ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆå¯¾ç­–', url: 'https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/koyou_roudou/koyoukintou/seisaku06/index.html' }
    };

    // ========================================
    // åˆ¶åº¦æ”¹æ­£ãƒ‡ãƒ¼ã‚¿
    // ========================================
    const regulations = [
      { id: 1, date: '2026/01', category: 'ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯', title: 'ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯åˆ¶åº¦ã®ç¾©å‹™åŒ–å¯¾è±¡ãŒå…¨äº‹æ¥­å ´ã«æ‹¡å¤§', summary: 'åŠ´åƒå®‰å…¨è¡›ç”Ÿæ³•ã®æ”¹æ­£ã«ã‚ˆã‚Šã€å¾“æ¥­å“¡50äººæœªæº€ã®äº‹æ¥­å ´ã«ã‚‚ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯ã®å®Ÿæ–½ãŒç¾©å‹™åŒ–ã•ã‚Œã¾ã—ãŸã€‚', source: 'åšç”ŸåŠ´åƒçœ', color: '#e91e63' },
      { id: 2, date: '2025/12', category: 'åŒ–å­¦ç‰©è³ªç®¡ç†', title: 'ãƒªã‚¹ã‚¯ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆå¯¾è±¡ç‰©è³ªã®è¿½åŠ ï¼ˆ234ç‰©è³ªï¼‰', summary: 'SDSã®é€šçŸ¥ãƒ»è¡¨ç¤ºç¾©å‹™å¯¾è±¡ã¨ãªã‚‹ãƒªã‚¹ã‚¯ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆå¯¾è±¡ç‰©è³ªãŒæ–°ãŸã«234ç‰©è³ªè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚', source: 'å®‰å…¨è¡›ç”Ÿæƒ…å ±ã‚»ãƒ³ã‚¿ãƒ¼', color: '#ff9800' },
      { id: 3, date: '2025/11', category: 'åŠ´åƒæ™‚é–“', title: 'å‹¤å‹™é–“ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«åˆ¶åº¦ã®åŠªåŠ›ç¾©å‹™å¼·åŒ–', summary: 'çµ‚æ¥­ã‹ã‚‰æ¬¡ã®å§‹æ¥­ã¾ã§11æ™‚é–“ä»¥ä¸Šã®ä¼‘æ¯ç¢ºä¿ã«ã¤ã„ã¦ã€åŠªåŠ›ç¾©å‹™ã®å®ŸåŠ¹æ€§ã‚’é«˜ã‚ã‚‹æªç½®ãŒæ¤œè¨ã•ã‚Œã¦ã„ã¾ã™ã€‚', source: 'åšç”ŸåŠ´åƒçœ', color: '#2196f3' },
      { id: 4, date: '2025/10', category: 'åŒ–å­¦ç‰©è³ªç®¡ç†', title: 'åŠ´åƒå®‰å…¨è¡›ç”Ÿé–¢ä¿‚æ‰‹ç¶šãã®é›»å­ç”³è«‹ç¾©å‹™åŒ–', summary: 'åŠ´åƒè€…æ­»å‚·ç—…å ±å‘Šã€ç”£æ¥­åŒ»é¸ä»»å ±å‘Šç­‰ã®æ‰‹ç¶šãã«ã¤ã„ã¦é›»å­ç”³è«‹ãŒåŸå‰‡ç¾©å‹™åŒ–ã•ã‚Œã¾ã—ãŸã€‚', source: 'åšç”ŸåŠ´åƒçœ', color: '#ff9800' },
      { id: 5, date: '2025/09', category: 'ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆ', title: 'ã‚«ã‚¹ã‚¿ãƒãƒ¼ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆé˜²æ­¢æªç½®ã®äº‹æ¥­ä¸»ç¾©å‹™åŒ–', summary: 'åŠ´åƒæ–½ç­–ç·åˆæ¨é€²æ³•ç­‰ã®æ”¹æ­£ã«ã‚ˆã‚Šã€ã‚«ã‚¹ãƒãƒ©é˜²æ­¢ã®ãŸã‚ã®é›‡ç”¨ç®¡ç†ä¸Šã®æªç½®ãŒäº‹æ¥­ä¸»ã«ç¾©å‹™ä»˜ã‘ã‚‰ã‚Œã¾ã™ã€‚', source: 'åšç”ŸåŠ´åƒçœ', color: '#9c27b0' },
    ];

    // ========================================
    // ãƒšãƒ¼ã‚¸è¡¨ç¤º
    // ========================================
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('page-' + pageId).classList.add('active');
      const navBtn = document.querySelector('.nav-btn[data-page="' + pageId + '"]');
      if (navBtn) navBtn.classList.add('active');
      if (pageId === 'regulations') renderTimeline('all');
    }

    // ========================================
    // åˆ¶åº¦æ”¹æ­£ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
    // ========================================
    function renderTimeline(filter) {
      const filtered = filter === 'all' ? regulations : regulations.filter(r => r.category === filter);
      document.getElementById('timeline').innerHTML = filtered.map(r => {
        const source = OFFICIAL_SOURCES[r.category];
        return `
          <div class="timeline-item">
            <div class="timeline-dot" style="background: ${r.color}"></div>
            <div class="timeline-card">
              <div class="timeline-meta">
                <span class="timeline-date">${r.date}</span>
                <span class="timeline-category" style="background: ${r.color}">${r.category}</span>
              </div>
              <div class="timeline-title">${r.title}</div>
              <div class="timeline-summary">${r.summary}</div>
              <div class="timeline-footer">
                <span class="timeline-source">å‡ºå…¸: ${r.source}</span>
                <a class="timeline-link" href="${source.url}" target="_blank" rel="noopener">${source.name} â†’</a>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function filterRegulations(category, btn) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderTimeline(category);
    }

    // ========================================
    // æœ€æ–°è¨˜äº‹ä¸€è¦§
    // ========================================
    function renderArticles() {
      if (!articlesData || !articlesData.journals) return;
      
      document.getElementById('articles-list').innerHTML = articlesData.journals.map(j => `
        <div class="journal-section">
          <div class="journal-header" style="background: ${j.color}">
            <h3>${j.name}</h3>
            <div class="issue">${j.latest_issue || ''}</div>
          </div>
          <div class="journal-articles">
            ${j.articles && j.articles.length > 0 ? j.articles.map(a => `
              <div class="article-item">
                <div class="article-title">${a.title}</div>
                ${a.authors ? `<div class="article-authors">${a.authors}</div>` : ''}
              </div>
            `).join('') : '<div class="article-item" style="text-align:center;"><div class="article-title" style="color:#64748b;">J-STAGEã§æœ€æ–°è«–æ–‡ã‚’ç¢ºèª â†“</div></div>'}
          </div>
          <div class="journal-footer">
            <a href="${j.url}" target="_blank" rel="noopener">ğŸ“– J-STAGEã§è¦‹ã‚‹ â†’</a>
          </div>
        </div>
      `).join('');
    }

    // ========================================
    // é›‘èªŒä¸€è¦§ã‚°ãƒªãƒƒãƒ‰
    // ========================================
    function renderJournalGrid() {
      if (!articlesData || !articlesData.journals) return;
      
      document.getElementById('journal-grid').innerHTML = articlesData.journals.map(j => `
        <div class="journal-card" onclick="showJournalDetail('${j.id}')">
          <div class="journal-card-header">
            <div class="journal-card-icon" style="background: ${j.color}20; color: ${j.color}">ğŸ“š</div>
            <div class="journal-card-info">
              <h3>${j.name}</h3>
              <p>${j.publisher}</p>
            </div>
          </div>
          <div class="journal-card-desc">${j.description || ''}</div>
        </div>
      `).join('');
    }

    // ========================================
    // é›‘èªŒè©³ç´°ãƒšãƒ¼ã‚¸
    // ========================================
    function showJournalDetail(id) {
      if (!articlesData || !articlesData.journals) return;
      
      const j = articlesData.journals.find(x => x.id === id);
      if (!j) return;
      document.getElementById('journal-detail-content').innerHTML = `
        <div class="journal-detail-header" style="background: ${j.color}">
          <h2>${j.name}</h2>
          <p class="pub">${j.publisher} ï½œ ${j.latest_issue || 'æœ€æ–°å·'}</p>
          <p class="desc">${j.description || ''}</p>
          <a href="${j.url}" target="_blank" rel="noopener">J-STAGEã§æœ€æ–°å·ã‚’è¦‹ã‚‹ â†’</a>
        </div>
        <h3 style="margin-bottom: 0.5rem; font-size: 0.9rem; font-weight: 700;">æœ€æ–°å·ã®è«–æ–‡</h3>
        ${j.articles && j.articles.length > 0 ? j.articles.map(a => `
          <div class="detail-article">
            <h4>${a.title}</h4>
            ${a.authors ? `<div class="authors">${a.authors}</div>` : ''}
          </div>
        `).join('') : '<p style="color:#64748b;font-size:0.8rem;">è«–æ–‡æƒ…å ±ã‚’å–å¾—ä¸­...</p>'}
        <div style="margin-top: 1rem; text-align: center;">
          <a href="${j.url}" target="_blank" rel="noopener" style="display: inline-block; background: ${j.color}; color: #fff; padding: 0.6rem 1.5rem; border-radius: 6px; text-decoration: none; font-size: 0.8rem; font-weight: 700;">ğŸ“– J-STAGEã§å…¨è«–æ–‡ã‚’è¦‹ã‚‹</a>
        </div>
      `;
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById('page-journal-detail').classList.add('active');
    }

    // ========================================
    // åˆæœŸåŒ–
    // ========================================
    document.addEventListener('DOMContentLoaded', () => {
      renderTimeline('all');
      loadArticlesData();  // J-STAGEã‹ã‚‰ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–å¾—
    });
  </script>
</body>
</html>
